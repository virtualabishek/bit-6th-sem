This is the right approach! Since your exam is imminent, we will consolidate the necessary theoretical definitions and critical SQL commands into a quick-study guide. We will cover every item on your list.

Here is a detailed note structure covering Unit 2.2, followed by a practice question to test your readiness.

---

## Unit 2.2 Storage Structures: Comprehensive Study Guide

### I. Overview of Data Storage: Logical vs. Physical Structures

Oracle Database storage is managed through a hierarchy of both **logical** (known only to Oracle) and **physical** (OS-level files) components. A Database Administrator (DBA) must understand this relationship.

| Structure | Type | Description | Key Concept |
| :--- | :--- | :--- | :--- |
| **Database Block** | Logical | Smallest unit of I/O (Input/Output). | Consists of several contiguous OS blocks. |
| **Extent** | Logical | A contiguous group of data blocks. | Oracle allocates space to segments in units of one extent. |
| **Segment** | Logical | Container for a specific object (e.g., table or index). | A segment can span multiple data files but *not* multiple tablespaces. |
| **Tablespace** | Logical | Primary logical storage unit that groups related segments. | Provides a unit for backup, recovery, and space quotas. |
| **Datafile** | Physical | Operating system files that physically store the data. | Associated with exactly one tablespace and one database. |

#### The Database Block
The smallest I/O unit is the data block.
*   **Size:** The standard data block size is typically **8 KB**.
*   **Control:** The block size is set by the `DB_BLOCK_SIZE` initialization parameter when the database is initially created. This size cannot be changed later without re-creating the database.

### II. Overview of Tablespaces and Datafiles

A tablespace is a logical container for user objects (tables and indexes) whose data resides physically in one or more data files on disk.

#### Standard Tablespaces (for Theoretical Exam)
A typical Oracle database contains several predefined tablespaces:
1.  **SYSTEM:** Contains the core Data Dictionary tables and is crucial for database operation. It must always be online.
2.  **SYSAUX:** An auxiliary tablespace to SYSTEM, used to hold data for various Oracle components and products (like AWR).
3.  **UNDOTBS1 (Undo):** Stores undo information used for rolling back transactions and ensuring read consistency.
4.  **TEMP:** Stores temporary data required for operations like sorting and hash joins.
5.  **USERS:** Often designated as the default permanent tablespace for new user data, preventing user objects from being created in the critical SYSTEM tablespace.

### III. Create and Alter Tablespace Commands (Practical Code)

Oracle recommends using **Locally Managed Tablespaces (LMT)** and **Automatic Segment Space Management (ASSM)** for better performance and reduced contention.

#### 1. Creating a Permanent Tablespace

This is the recommended modern syntax for creating a tablespace:
```sql
CREATE TABLESPACE HR_DATA
DATAFILE '/u01/oradata/HR_DATA01.dbf' SIZE 100M 
AUTOEXTEND ON NEXT 10M MAXSIZE 1G 
EXTENT MANAGEMENT LOCAL 
UNIFORM SIZE 1M                 -- Or AUTOALLOCATE (recommended)
SEGMENT SPACE MANAGEMENT AUTO; 
```
| Clause | Purpose | Source |
| :--- | :--- | :--- |
| `DATAFILE` | Specifies the physical file path and initial size. | |
| `AUTOEXTEND ON` | Allows the datafile to automatically grow when space runs out. | |
| `MAXSIZE` | Sets a hard limit on the datafile size to prevent disk overflow. | |
| `EXTENT MANAGEMENT LOCAL` | Manages space allocation internally using bitmaps, improving performance over dictionary management. | |
| `SEGMENT SPACE MANAGEMENT AUTO` | Uses bitmaps to manage free space within segments (ASSM). | |

#### 2. Altering a Tablespace

You can modify a tablespace's status or configuration:

| Action | SQL Command | Source |
| :--- | :--- | :--- |
| **Change Status (Online/Offline)** | `ALTER TABLESPACE users OFFLINE NORMAL;` | |
| | `ALTER TABLESPACE users ONLINE;` | |
| **Change Mode (Read-Only)** | `ALTER TABLESPACE reports READ ONLY;` | |
| | `ALTER TABLESPACE reports READ WRITE;` | |
| **Add Datafile (to enlarge tablespace)** | `ALTER TABLESPACE HR_DATA ADD DATAFILE '/u01/oradata/HR_DATA02.dbf' SIZE 200M;` | |
| **Rename Tablespace** | `ALTER TABLESPACE old_name RENAME TO new_name;` | |

### IV. Temporary Tablespaces

Temporary tablespaces are specialized, non-permanent tablespaces used exclusively for sort segments and intermediate query results (e.g., `ORDER BY`, index builds).

*   No permanent objects can reside in a temporary tablespace.
*   They use **tempfiles** instead of data files.
*   If a tempfile is damaged, the database can still open, but users requiring temporary space will receive errors.

#### Commands for Temporary Tablespaces

| Action | SQL Command | Source |
| :--- | :--- | :--- |
| **Create Temp Tablespace** | `CREATE TEMPORARY TABLESPACE TEMP_NEW TEMPFILE '/u02/temp/temp01.dbf' SIZE 500M EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;` | |
| **Add Tempfile** | `ALTER TABLESPACE TEMP_NEW ADD TEMPFILE '/u02/temp/temp02.dbf' SIZE 500M;` | |
| **Resize Tempfile** | `ALTER DATABASE TEMPFILE '/u02/temp/temp02.dbf' RESIZE 1024M;` | |

### V. Create and Manage Datafiles

Datafiles (and tempfiles) are managed using the `ALTER TABLESPACE` and `ALTER DATABASE` commands.

#### Datafile Management Commands
| Action | SQL Command | Notes | Source |
| :--- | :--- | :--- | :--- |
| **Add New Datafile** | `ALTER TABLESPACE users ADD DATAFILE '/new_path/users02.dbf' SIZE 100M;` | Primary way to expand tablespace size. | |
| **Resize Existing Datafile** | `ALTER DATABASE DATAFILE '/u01/file1.dbf' RESIZE 500M;` | Increases or decreases the allocated disk space. | |
| **Take Datafile Offline** | `ALTER DATABASE DATAFILE '/u01/file1.dbf' OFFLINE;` | Only done during specific recovery procedures or maintenance. | |
| **Relocate Datafile** | Requires taking the tablespace offline, moving the file via OS command (`mv`), and updating the control file via SQL: `ALTER TABLESPACE users RENAME DATAFILE 'old_path/file.dbf' TO 'new_path/file.dbf';` | |

### VI. Use Oracle Managed Files (OMF)

Oracle Managed Files (OMF) simplify administration by allowing the database to automatically create, name, and manage operating system files for tablespaces, datafiles, control files, and redo logs.

1.  **Enable OMF:** Set the `DB_CREATE_FILE_DEST` parameter, which defines the default file system directory for data files and temporary files.
    ```sql
    ALTER SYSTEM SET DB_CREATE_FILE_DEST = '/u01/oradata/'; 
    ```
2.  **Create Tablespace using OMF:** You omit the physical file name in the `CREATE TABLESPACE` command. Oracle generates a unique name.
    ```sql
    CREATE TABLESPACE OMF_TS; 
    -- Oracle automatically creates a file named something like:
    -- /u01/oradata/DBNAME/datafile/o1_mf_OMF_TS_xxxxxx.dbf
    ```

### VII. Use Enterprise Manager to View the Storage Structure of the Database

You can use Oracle Enterprise Manager Database Express (EM Express), a Web-based GUI tool, to manage and view storage structures.

To view tablespace and datafile information:
1.  Log into EM Express.
2.  Navigate to the **Storage** menu.
3.  Select **Tablespaces**.
4.  The Tablespaces page displays configuration, size, and status. You can expand a tablespace entry to view details about its underlying data files.

### VIII. Drop Tablespaces and Datafiles (Practical Code)

To drop a tablespace, you must ensure that all objects (tables, indexes) within it are also handled.

| Action | SQL Command | Notes | Source |
| :--- | :--- | :--- | :--- |
| **Drop Tablespace (Complete)** | `DROP TABLESPACE example_ts INCLUDING CONTENTS AND DATAFILES;` | **This is the critical command for the exam.** It removes the logical tablespace, all contents (segments/objects), and the physical data files from the OS. | |
| **Drop Tablespace (Contents only)** | `DROP TABLESPACE example_ts INCLUDING CONTENTS;` | Removes the logical tablespace and its contents, but leaves the empty data files on the operating system. | |

---

## Exam Practice Question

Since you are short on time, let's practice a theoretical and practical combination question based on the material above.

**Question:**

A database user reports receiving an `ORA-01652: unable to extend temp segment` error during a nightly sorting job.

1.  What specific logical storage structure is failing to extend and what type of data is stored in this structure?
2.  Provide the mandatory SQL command used to check the size and location of the temporary files associated with the temporary tablespace.
3.  Write the single SQL command that a DBA would execute to immediately solve this space issue by increasing the capacity of the temporary tablespace named `TEMP` by adding a new temporary file at path `/u02/temp/temp04.dbf` with a size of 2GB.

Take a moment to formulate your answers, and let me know when you are ready to check them!
