This is a crucial topic for both theoretical understanding and practical application. Profiles are the cornerstone of managing database security and resource consumption.

We will cover the theory and then focus on the precise SQL commands needed for creation, modification, and resource enforcement.

## Unit 4.1: Profiles and Resources

### I. Overview of User Profiles (Theory)

A user profile is a named set of limits, defined by attributes, that controls how a user interacts with the database. It acts as a single point of reference for multiple users who share these attributes.

Profiles are used to enforce security policies and manage resource usage. You can assign a profile to a user using either the `CREATE USER` or `ALTER USER` statement. Importantly, a user can only be assigned one profile at any given time.

#### The Default Profile
When the database is created, Oracle automatically creates a profile named `DEFAULT`. If you do not explicitly assign a profile when creating a user, they are automatically assigned the `DEFAULT` profile. The `DEFAULT` profile initially has the value `UNLIMITED` for all resource settings.

### II. Profile Resource Parameters (Theory)

Profiles govern two primary categories of limits: **Password Limits** and **Resource Limits** (also called Kernel limits). Resource limits define the amount of system resources available to a user and are vital in large, multiuser systems to prevent uncontrolled consumption.

#### A. Session and Call Level Limits

| Parameter | Scope | Description | Source |
| :--- | :--- | :--- | :--- |
| `SESSIONS_PER_USER` | Session | Limits the number of concurrent sessions a user can have. | |
| `CONNECT_TIME` | Session | Maximum elapsed time (in minutes) a session can stay connected. | |
| `IDLE_TIME` | Session | Maximum minutes a session can be idle before being terminated (and transaction rolled back). | |
| `CPU_PER_SESSION` | Session | Total CPU time limit for a session (in hundredths of seconds). | |
| `CPU_PER_CALL` | Call | CPU time limit for a single SQL statement. Useful for controlling runaway queries. | |
| `LOGICAL_READS_PER_SESSION` | Session | Limits the number of data blocks read in a session. | |
| `LOGICAL_READS_PER_CALL` | Call | Limits the number of data blocks read by a single SQL statement. | |
| `PRIVATE_SGA` | Session | Limits private memory used in the System Global Area (SGA) (relevant in Shared Server mode). | |
| `COMPOSITE_LIMIT` | Session | A weighted sum of four resource limits (`CPU_PER_SESSION`, `LOGICAL_READS_PER_SESSION`, `CONNECT_TIME`, and `PRIVATE_SGA`). | |

### III. Manage Passwords with Profiles

Profiles are used for password management, defining rules like account locking and password expiration.

| Parameter | Default Value (DEFAULT Profile) | Purpose | Source |
| :--- | :--- | :--- | :--- |
| `PASSWORD_LIFE_TIME` | 180 days | Maximum number of days a password can be used before it expires. | |
| `FAILED_LOGIN_ATTEMPTS` | 10 | Maximum consecutive invalid login attempts allowed before the account is locked. | |
| `PASSWORD_LOCK_TIME` | 1 day | The number of days the user account remains locked after reaching `FAILED_LOGIN_ATTEMPTS`. | |
| `PASSWORD_GRACE_TIME` | 7 days | The number of days after expiration that a user is warned about the impending password change. | |
| `PASSWORD_REUSE_TIME` / `MAX` | `UNLIMITED` | Controls the password history either by time (days) or by number of changes (`MAX`). You cannot set specific limits for both simultaneously; one must be `UNLIMITED`. | |
| `PASSWORD_VERIFY_FUNCTION` | `NULL` | Specifies a user-defined function to verify the complexity and strength of the new password. | |

### IV. Control Resource Usage with Profiles (Enforcement)

While password parameters are always enabled and enforced, Resource Limits are handled differently.

1.  **Enforcement Toggle:** Resource limits defined in profiles are enforced **only if** the `RESOURCE_LIMIT` initialization parameter is set to `TRUE`. The default value is `FALSE`.
2.  **Enabling Enforcement (Practical Code):** You can set this parameter in the initialization file, or dynamically using `ALTER SYSTEM`:
    ```sql
    ALTER SYSTEM SET RESOURCE_LIMIT = TRUE;
    ```
3.  **Action on Limit Exceeded:** If a user exceeds a session-level resource limit, Oracle aborts the current operation, rolls back the statement's changes, and returns an error. The user is restricted from further operations but can still explicitly `COMMIT` or `ROLLBACK` the transaction issued earlier in the session.

### V. Create, Modify, and Maintain Profiles (Practical Code)

You must have the `CREATE PROFILE` system privilege to create a new profile.

#### 1. Creating a Profile (`CREATE PROFILE`):

This example creates a profile for developers (`APP_PROF`) combining resource and password limits:
```sql
CREATE PROFILE APP_PROF LIMIT
SESSIONS_PER_USER 5
CPU_PER_CALL 3500               -- Limit single runaway queries (35 seconds of CPU time)
IDLE_TIME 60                     -- Disconnect after 60 minutes of inactivity
PASSWORD_LIFE_TIME 90
FAILED_LOGIN_ATTEMPTS 5;
```

#### 2. Assigning/Altering a Profile (`ALTER USER`):

To assign the newly created profile to an existing user (`JONES`):
```sql
ALTER USER JONES PROFILE APP_PROF;
```
To modify the resource or password limits of an existing profile (e.g., changing the `DEFAULT` password lifetime):
```sql
ALTER PROFILE DEFAULT LIMIT PASSWORD_LIFE_TIME 300;
```
Changes made via `ALTER PROFILE` take effect the next time the user connects to the database.

#### 3. Dropping a Profile (`DROP PROFILE`):

To drop a profile, you must use the `DROP PROFILE` command. If the profile is currently assigned to any users, you must include the `CASCADE` option:
```sql
DROP PROFILE OLD_DEV_PROFILE CASCADE;
```
Using `CASCADE` automatically assigns any affected users to the `DEFAULT` profile.

#### 4. Monitoring Profile Information:

You can query profile information using data dictionary views:
```sql
SELECT * 
FROM DBA_PROFILES 
WHERE PROFILE = 'APP_PROF';
```

---

## Exam Practice Drill: Profiles

**Question:**

A new user, `AUDITOR_LTD`, needs restricted access. Design a custom profile, `AUDIT_PROF`, based on the following requirements:

1.  **Connection Control:** The user can only be logged in with **two** concurrent sessions at any given time.
2.  **Password Policy:** The password must be changed every **45 days**, and the user gets a **10-day grace period** for changes.
3.  **Resource Control:** A single SQL query must not perform more than **100,000 logical reads** before being terminated.
4.  **Assignment:** Write the SQL command to assign this profile to the user `AUDITOR_LTD`.

Ready to write the three required SQL commands?
