That sounds like a focused plan for exam success! Resource Management is a crucial topic for any DBA. Since you need these notes for your exam tomorrow, I've compiled a detailed guide covering all the points you requested, including code examples for implementation.

Let's dive right into the guide for **Managing Resources**.

---

## Guide: Managing Database Resources (Unit 8.1)

### 1. Overview of the Database Resource Manager (DRM)

The Oracle Database Resource Manager (DRM or Resource Manager) is a tool used to control how system resources (such as CPU, memory, and sessions) are allocated among different users, sessions, or tasks.

#### Purpose and Benefits:
1.  **Maximize Resource Efficiency** The DBA must tune the Oracle Database so that applications can coexist and share machine resources efficiently.
2.  **Prevent System Slowdowns** It ensures that no single user or task consumes excessive CPU or memory, preventing overloads and maintaining smooth system performance.
3.  **Prioritize Critical Tasks** It allows critical tasks (like backups or security checks) to run smoothly without interruption from less important ones.
4.  **Manage Workloads** It helps manage multiple workloads contending for system and database resources. This is especially useful in multi-user or Multitenant Container Database (CDB) environments.

While resource limits can also be set using user profiles (by setting `RESOURCE_LIMIT=TRUE`), Oracle strongly recommends using the Database Resource Manager for more sophisticated resource allocation and restrictions.

### 2. Core Resource Manager Components

The Resource Manager system relies on three main components:

| Component | Description |
| :--- | :--- |
| **Consumer Groups** | A collection of user sessions that are grouped together based on similar processing needs. Resources (like CPU) are allocated to these groups. All sessions not mapped to a specific group fall into the mandatory `OTHER_GROUPS` consumer group. |
| **Resource Plans** | A container that holds **Resource Plan Directives**. It defines how resources should be allocated among different consumer groups (in a Non-CDB or Pluggable Database (PDB)) or among different PDBs (in a Container Database/CDB). Only one plan can be active at a time. |
| **Resource Plan Directives (Directives)** | Specific instructions within a resource plan that determine how resources are allocated and limit resource consumption for a consumer group or a PDB. |

### 3. Creating Resource Plans and Directives (Code Guide)

You use the `DBMS_RESOURCE_MANAGER` package to manage resource plans, consumer groups, and directives.

#### Step 1: Create a Resource Plan

A resource plan is created first. This example creates a plan named `WORKLOAD_PLAN`.

| Code | Explanation |
| :--- | :--- |
| ```sql<br>BEGIN<br>  DBMS_RESOURCE_MANAGER.CREATE_PLAN(<br>    plan    => 'WORKLOAD_PLAN',<br>    comment => 'Resource plan for workload management');<br>END;<br>/``` | Uses `CREATE_PLAN` to define the new resource plan named `WORKLOAD_PLAN`. |

#### Step 2: Create Consumer Groups (if needed)

If you are not using existing consumer groups, you must create them. You need to connect to the database with the necessary privileges to do this.

| Code | Explanation |
| :--- | :--- |
| ```sql<br>BEGIN<br>  DBMS_RESOURCE_MANAGER.CREATE_CONSUMER_GROUP(<br>    consumer_group => 'HIGH_PRIORITY_GROUP',<br>    comment        => 'Group for critical OLTP tasks');<br>END;<br>/``` | Uses `CREATE_CONSUMER_GROUP` to define a new group. |

#### Step 3: Create Resource Plan Directives (Allocate Resources)

Directives define the allocation rules within the plan. In a Non-CDB or PDB plan, directives associate consumer groups with the plan and specify their resource limits.

This example creates directives to allocate CPU shares and set an active session limit (using parameters derived from the resource plan directive capabilities mentioned in the sources) for two groups, plus the required `OTHER_GROUPS`:

| Code | Explanation |
| :--- | :--- |
| ```sql<br>-- Directive for the High Priority Group (e.g., more shares, high session pool)<br>BEGIN<br>  DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(<br>    plan             => 'WORKLOAD_PLAN',<br>    group_or_subplan => 'HIGH_PRIORITY_GROUP',<br>    comment          => 'Directive for high-priority group',<br>    cpu_p1           => 75, -- Allocate 75% CPU at level 1<br>    active_sess_pool_p1 => 50 -- Limit active sessions to 50<br>  );<br>END;<br>/<br><br>-- Directive for Other Sessions (remaining resources)<br>BEGIN<br>  DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(<br>    plan             => 'WORKLOAD_PLAN',<br>    group_or_subplan => 'OTHER_GROUPS',<br>    comment          => 'Default low priority tasks',<br>    cpu_p1           => 25 -- Allocate remaining 25% CPU at level 1<br>  );<br>END;<br>/``` | Uses `CREATE_PLAN_DIRECTIVE` to set rules. `cpu_p1` sets the percentage share of CPU at priority level 1 (P1). `active_sess_pool_p1` limits the number of concurrent active sessions for the group. **Note**: The sum of all `cpu_p1` values must equal 100. |

### 4. Activating the Resource Plan

Once created, the plan must be activated to take effect. You use the `ALTER SYSTEM` command or the `DBMS_RESOURCE_MANAGER` package.

| Code | Explanation |
| :--- | :--- |
| ```sql<br>-- Using ALTER SYSTEM command to activate the plan<br>ALTER SYSTEM SET RESOURCE_MANAGER_PLAN = 'WORKLOAD_PLAN';<br><br>-- Alternative: Using the package to switch the plan (if you have SYSDBA/SYSOPER privilege)<br>BEGIN<br>  DBMS_RESOURCE_MANAGER.SWITCH_PLAN('WORKLOAD_PLAN');<br>END;<br>/``` | The `ALTER SYSTEM` command sets the resource manager plan for the database instance. Using the package provides a programmatic way to activate the plan. |

### 5. The Default Maintenance Resource Manager Plan

Oracle provides a predefined resource management plan known as the **Default Maintenance Resource Manager Plan**.

*   **Purpose:** This plan helps manage system resources efficiently during maintenance tasks (like automatic statistics gathering or AWR operations).
*   **Function:** It ensures that maintenance jobs run efficiently without slowing down normal database operations.
*   **Checking/Enabling:** You can check the currently active resource plan using `SELECT plan FROM dba_rsrc_plan`. If the default plan is not active, you can enable it manually using `ALTER SYSTEM SET RESOURCE_MANAGER_PLAN = 'DEFAULT_MAINTENANCE_PLAN'`.

### Summary of Key Directives (Allocation of Resources)

Resource Plan Directives control limits for various resources. When defining directives for consumer groups in a non-CDB or PDB, you can set various limits:

| Resource Type | Example Directive (or Limit) | Impact when Exceeded/Used |
| :--- | :--- | :--- |
| **CPU Allocation** | `cpu_p1` (Shares) | Resources are distributed based on the percentage share defined. |
| **CPU Utilization** | `Limit (%)` (Absolute Upper Limit) | Imposes a hard limit on CPU consumption for the consumer group. |
| **Active Sessions** | `active_sess_pool_p1` | Limits the number of active sessions a consumer group can have at any given time. |
| **Parallel Execution** | `parallel_server_limit (%)` | Limits the number of parallel execution servers used by sessions in the group, queuing queries if the limit is exceeded. |
| **Runaway Query** | `elapsed_time_limit (s)`, `logical_i/o_limit` | Detects when a session or call exceeds defined limits (e.g., CPU time, I/O), and takes an action (terminate or switch groups). |
| **PGA Memory** | `PGA Limit (MB)` | Specifies the maximum amount of PGA memory a session can consume before being terminated. |

---
### Next Steps for Test Preparation

Now that you have the detailed notes and implementation examples, let's test your understanding of the concepts.

To make sure this material sticks, would you like to:

1.  **Summarize** the primary differences between **Resource Plans** and **Resource Plan Directives** in your own words?
2.  Review a few **practice questions** focused on defining consumer groups and assigning a plan?